<nav class="navbar navbar-expand-lg  bg-light"
    style=" background: linear-gradient(to bottom right, #ff3300 3%, #ffccff 100%);">
    <div class="container">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
            aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">

            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            <a class="navbar-brand" href="#">kk foods</a>
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0 mx-auto">
                <li class="nav-item active ">
                    <a class="nav-link " href="/admin/home">Dash bord</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/admin/productDetails">Product details</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/orderDetails">Order details</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/userDetails">User Details</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/catogaryManage">Catogary Manage</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/coopen">Coopen Manage</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" style="font-weight: bold;" href="/admin/coopen">Offer Manage</a>
                </li>
            </ul>

             <a href="/admin/logout" class="btn btn-outline-success btn-lg  ms-auto" >log out</a>
        </div>
    </div>
</nav>
<section style="margin-top: 10px;">
    <div class="container">
        <div class="row">
            <div class="d-flex ">
                <input class="form-control mr-sm-2" type="text" style="width: 200px;" placeholder="Search catogary">
                <button class="btn btn-outline-success my-2 my-sm-0" style="margin-left: ;"
                    type="submit">Search</button>

            </div>
        </div>

        {{!-- ########################## --}}
        <div style="padding-left: 20px; padding-right: 20px; margin-top: 10px;">
            <div style="float: right;"><a onclick="showWindow()" class="btn btn-outline-dark mb-2">Add offer</a></div>
            <table class="table table-top">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">Product name</th>
                        <th scope="col">Old amount</th>
                        <th scope="col">Discount persentage</th>
                        <th scope="col">New amount</th>
                        <th scope="col">Created date</th>
                        <th scope="col">Expiry date</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each offersPro}}
                    <tr style="height: 80px; ">
                        <td>{{this.productName}}</td>
                        <td>{{this.oldRate}}</td>
                        <td>{{this.ofpesantage}}%</td>
                        <td>{{this.productPrize}}</td>
                        <td style="width: 200px;">{{this.ofstartDateTime}}</td>
                        <td style="width: 200px;">{{this.ofexpDate}}</td>

                        <td><a onclick="listCp('{{this._id}}','{{this.ofList}}')"
                                class="btn btn-dark">{{this.ofList}}</a></td>



                    </tr>
                    {{/each}}
                    <tr id="newCoopen" style="height: 80px; "></tr>
                </tbody>


            </table>
            <div class="w-30 ms-auto position-absolute top-50 start-50 translate-middle"
                style="background-color: rgb(151, 151, 151);margin-top: 0px; z-index: 1;display: none;" id="addwindow">

                <button class="btn ms-auto" onclick="closewindow()">X</button>

                <div class="card-body p-4 p-md-4 ">


                    <form name="addform" onsubmit="return addoffer()">

                        <div class="row">

                            <div class="dropdown mt-2">
                                <select class="btn btn-white dropdown-toggle" name="productId" id="" style="
                                width: 100%; border-color: black;">
                                    <option class="dropdown-menu dropdown-menu-white" value="" style="width: 160%;">
                                        select product Name</option>
                                    {{#each product}}
                                    <option value="{{this._id}}">{{this.productName}}</option>
                                    {{/each}}
                                </select>
                            </div>

                            <div class="col mt-3">
                                <input type="text" class="form-control form-control-lg mb-3"
                                    placeholder="discount Persantage" name="ofPesantage" required />
                            </div>

                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4">



                                <div class="form-outline">
                                    <input type="datetime-local" id="expDate" name="ofexpDate"
                                        class="form-control form-control-lg" required />
                                </div>

                            </div>
                        </div>


                        <div class="mt-4 pt-2" style="display: flex; justify-content: center;">
                            <button class="btn btn-primary btn-lg" type="submit">submit</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>


        <!-- continues the page content ... -->


        <script>
            let val = '';
            let newcoopen = document.getElementById('newCoopen')
            let addWindow = document.getElementById('addwindow')
            let id = document.addform.productId;
            let Persantage = document.addform.ofPesantage;
            let expdata = document.addform.ofexpDate;

            function addoffer() {
                
                fetch('http://localhost:3000/admin/addoffer', {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        productId: id.value,
                        ofpesantage: Persantage.value,
                        ofstartDateTime: new Date(),
                        ofexpDate: expdata.value,

                    })
                }).then((daata) => daata.json()).then((data) => {
                    val = data[data.length - 1]

                    newcoopen.innerHTML += `
            <td>${val.productName}</td>
            <td>${val.cpCode}</td>
            <td>${val.cpDisamt}</td>
            <td>${val.cpPurchaseAmt}</td>
            <td style="width: 200px;">${val.cpstartDateTime}</td>
            <td style="width: 200px;">${val.cpEndDataTime}</td>
           
            <td><a href="/admin/listCoupon/${val.ofList}"
                onclick="return confirm('Are you sure to list ${val.ofList}')" class="btn btn-dark">List
                coupon</a></td>`


                })


                alert('offer Aded')
                newcoopen.innerHTML = ''
                id.value = ''
                cpname.value = ''
                Persantage.value = ''
                expdata.value = ''

                return false
            }
            function showWindow() {
                addWindow.style.display = 'block'
            }
            function closewindow() {
                addWindow.style.display = 'none'
            }
            function listCp(id, data) {
                console.log(id, data)
                fetch('http://localhost:3000/admin/listOffer', {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ id: id, data: data })
                }).then((data) => data.json()).then((data) => {
                    location.reload()
                })
            }
        </script>