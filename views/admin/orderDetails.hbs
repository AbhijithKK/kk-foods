<nav class="navbar navbar-expand-lg  bg-light"
  style=" background: linear-gradient(to bottom right, #ff3300 3%, #ffccff 100%);">
  <div class="container">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
      aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
      <a class="navbar-brand" href="#">kk foods</a>
      <ul class="navbar-nav mr-auto mt-2 mt-lg-0 mx-auto">
        <li class="nav-item active ">
          <a class="nav-link " href="/admin/home">Dash bord</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/admin/productDetails">Product details</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/admin/orderDetails" style="font-weight: bold;">Order details</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/admin/userDetails">User Details</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/admin/catogaryManage">Catogary Manage</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/admin/coopen">Coopen Manage</a>
        </li>
         <li class="nav-item">
          <a class="nav-link" href="/admin/offer_create">Offer Manage</a>
        </li>
      </ul>

       <a href="/admin/logout" class="btn btn-outline-success btn-lg  ms-auto" >log out</a>
    </div>
  </div>
</nav>

<section style="margin-top: 10px;">
  <div class="container">
    <div class="row">
      <form class="form-inline my-2 my-lg-0">
        <div class="d-flex">
          <input class="form-control mr-sm-2" type="text" placeholder="Search product">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </div>
      </form>


    </div>

    <table class="table" style="margin-top: 20px;">
      <thead>
        <tr>
          <th scope="col">Ordered Date</th>
          <th scope="col">User Name</th>
          <th scope="col">User Address</th>
          <th scope="col">image</th>
          <th scope="col">Product Name</th>
          
          <th scope="col">Product Quantity</th>
          <th scope="col">price</th>
          <th scope="col">Coupen status</th>
          <th scope="col">Order Status</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        {{#each orders}}
        {{#each this.orderhistory}}
        {{#each this.productDetails}}

        <tr>

          <td>{{../this.OrderDate}}</td>
          <td>{{../../this.name1}}</td>
          <td style="width: 10rem;">{{../this.address}}</td>
          <td><img src="/images/{{this.image1.[0].filename}}" alt="" style="width: 40px;height: 50px;"></td>
          <td>{{this.productName}}</td>
          
          <td>{{this.count}}</td>
          <td>{{this.productPrize}}</td>
          <td>{{../this.coopenstatus.disAmt}}</td>
          {{#ifEqual this.orderStatus "Orderd"}}
          <td> <a id="{{../this.orderid}}" class="btn btn-primary btn-block mb-4">processing</a>
            {{/ifEqual}}
            
            
          </td>
          {{!-- <td>{{this.totalAmt}}</td> --}}

          <td>
            

            {{#ifEqual this.orderStatus "Delivered"}}
            <a class="btn btn-success btn-block mb-4">delivered</a>
            {{else}}
            {{#ifEqual this.orderStatus "Cancel"}}
            <a class="btn btn-danger btn-block mb-4">Canceled</a>
            {{else}}
            <a class="btn btn-white btn-block mb-4"
              onclick="orderCancel('{{../../this._id}}','{{this.proOrderId}}','{{this._id}}','Delivered')">delivered</a>
           
            <a class="btn btn-white btn-block mb-4"
              onclick="orderCancel('{{../../this._id}}','{{this.proOrderId}}','{{this._id}}','Cancel')">Cancel</a>
            {{/ifEqual}}
             {{/ifEqual}}

          </td>

          
        </tr>
        {{/each}}
        {{/each}}
        {{/each}}

      </tbody>
    </table>

  </div>
</section>

<script>

  function orderCancel(userid, orderid, productName, currentsts) {
    console.log(orderid, productName,)
    let stsbn = document.getElementById(orderid)
    confirm('are you sure')
    fetch('http://localhost:3000/admin/ordercancel', {
      method: "post",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ userid: userid, orderId: orderid, productName: productName, currentStatus: currentsts })
    }).then((data) => data.json()).then((data) => {
      console.log(data)
      location.reload()
      stsbn.classList.remove('btn-success')
      stsbn.classList.add('btn-danger')
      stsbn.innerHTML = 'cancell'

    })
  }
</script>